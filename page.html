<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S·∫£n Ph·∫©m - ƒê√£ Fix ·∫¢nh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            padding: 20px; 
            background-color: #f4f4f4; 
        }

        /* 1. THANH C√îNG C·ª§ */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 20px;
        }

        input, select, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        button { cursor: pointer; background: #007bff; color: white; border: none; }
        button:hover { background: #0056b3; }

        /* 2. B·∫¢NG D·ªÆ LI·ªÜU */
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border: 1px solid #ccc; vertical-align: middle; }
        
        th { background-color: #333; color: white; text-transform: uppercase; }

        /* Zebra Striping: D√≤ng L·∫ª Tr·∫Øng, D√≤ng Ch·∫µn ƒêen */
        tbody tr:nth-child(odd) {
            background-color: #ffffff;
            color: #000000;
        }
        tbody tr:nth-child(even) {
            background-color: #000000;
            color: #ffffff;
        }
        /* Vi·ªÅn m·ªù cho d√≤ng m√†u ƒëen ƒë·ªÉ d·ªÖ nh√¨n */
        tbody tr:nth-child(even) td { border-color: #444; }

        /* 3. GALLERY ·∫¢NH */
        .img-gallery { display: flex; gap: 5px; flex-wrap: wrap; max-width: 300px; }
        .product-thumb { 
            width: 50px; height: 50px; 
            object-fit: cover; 
            border: 1px solid #999; 
            border-radius: 4px;
            background-color: #fff;
        }

        /* 4. PH√ÇN TRANG */
        .pagination { margin-top: 20px; display: flex; justify-content: center; gap: 10px; align-items: center; }
        .page-info { font-weight: bold; }
    </style>
</head>
<body>

    <div class="controls">
        <input type="text" id="searchInput" placeholder="üîç T√¨m theo t√™n..." oninput="handleSearch()" style="flex: 1; min-width: 200px;">
        
        <label>Hi·ªÉn th·ªã:</label>
        <select id="pageSize" onchange="handlePageSize()">
            <option value="5">5 d√≤ng</option>
            <option value="10" selected>10 d√≤ng</option>
            <option value="20">20 d√≤ng</option>
        </select>

        <div style="display: flex; gap: 5px;">
            <button onclick="sortData('price', 'asc')">Gi√° TƒÉng</button>
            <button onclick="sortData('price', 'desc')">Gi√° Gi·∫£m</button>
            <button onclick="sortData('title', 'asc')">T√™n A-Z</button>
            <button onclick="sortData('title', 'desc')">T√™n Z-A</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="5%">ID</th>
                <th width="25%">H√¨nh ·∫¢nh</th>
                <th width="35%">T√™n S·∫£n Ph·∫©m</th>
                <th width="10%">Gi√° ($)</th>
                <th width="15%">Danh M·ª•c</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="5" style="text-align: center; padding: 20px;">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
        </tbody>
    </table>

    <div class="pagination">
        <button onclick="changePage(-1)">Tr∆∞·ªõc</button>
        <span class="page-info" id="pageInfo">Trang 1</span>
        <button onclick="changePage(1)">Sau</button>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        const API_URL = 'https://api.escuelajs.co/api/v1/products';
        let originalData = [];
        let currentData = [];
        let currentPage = 1;
        let pageSize = 10;

        // --- 1. L·∫§Y D·ªÆ LI·ªÜU T·ª™ API ---
        async function getAll() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                originalData = data;
                currentData = [...originalData];
                renderTable();
            } catch (err) {
                console.error(err);
                document.getElementById('tableBody').innerHTML = `<tr><td colspan="5" style="color:red; text-align:center;">L·ªói k·∫øt n·ªëi API!</td></tr>`;
            }
        }

        // --- 2. H√ÄM HI·ªÇN TH·ªä B·∫¢NG (CORE LOGIC) ---
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";

            // T√≠nh to√°n ph√¢n trang
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const items = currentData.slice(start, end);

            if (items.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu</td></tr>`;
                document.getElementById('pageInfo').innerText = "Trang 0 / 0";
                return;
            }

            items.forEach(item => {
                let imgHtml = '<div class="img-gallery">';
                
                // --- X·ª¨ L√ù ·∫¢NH TH√îNG MINH ---
                if (Array.isArray(item.images)) {
                    item.images.forEach(rawUrl => {
                        let cleanUrl = rawUrl;

                        // A. L√†m s·∫°ch chu·ªói URL (G·ªçt b·ªè [" "] th·ª´a th√£i)
                        if (typeof cleanUrl === 'string') {
                            try { 
                                cleanUrl = cleanUrl.replace(/[\[\]"\\']/g, ''); 
                            } catch (e) {}
                        }

                        // B. [QUAN TR·ªåNG] L·ªçc tr∆∞·ªõc c√°c domain ƒë√£ ch·∫øt ho·∫∑c b·ªã ch·∫∑n
                        // N·∫øu kh√¥ng l·ªçc, Console s·∫Ω b√°o l·ªói ƒë·ªè l√≤m
                        if (cleanUrl.includes('placeimg.com') || cleanUrl.includes('api.escuelajs.co')) {
                            // ƒê·ªïi sang ·∫£nh m·∫´u m√†u x√°m ngay l·∫≠p t·ª©c
                            cleanUrl = 'https://placehold.co/60x60/e0e0e0/333?text=Demo';
                        }

                        // C. Render th·∫ª IMG
                        if (cleanUrl && cleanUrl.startsWith('http')) {
                            imgHtml += `<img src="${cleanUrl}" class="product-thumb" 
                                loading="lazy"
                                onerror="this.onerror=null; this.src='https://placehold.co/60x60/orange/white?text=No+Img';">`;
                        }
                    });
                }
                imgHtml += '</div>';

                const row = `
                    <tr>
                        <td>${item.id}</td>
                        <td>${imgHtml}</td>
                        <td><strong>${item.title}</strong></td>
                        <td>$${item.price}</td>
                        <td>${item.category ? item.category.name : 'Unknown'}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // C·∫≠p nh·∫≠t th√¥ng tin trang
            const totalPages = Math.ceil(currentData.length / pageSize);
            document.getElementById('pageInfo').innerText = `Trang ${currentPage} / ${totalPages || 1}`;
        }

        // --- 3. C√ÅC H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN ---
        function handleSearch() {
            const key = document.getElementById('searchInput').value.toLowerCase();
            currentData = originalData.filter(i => i.title.toLowerCase().includes(key));
            currentPage = 1;
            renderTable();
        }

        function handlePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            renderTable();
        }

        function changePage(dir) {
            const total = Math.ceil(currentData.length / pageSize);
            const next = currentPage + dir;
            if (next >= 1 && next <= total) {
                currentPage = next;
                renderTable();
            }
        }

        function sortData(field, order) {
            currentData.sort((a, b) => {
                let va = a[field], vb = b[field];
                if (typeof va === 'string') { va = va.toLowerCase(); vb = vb.toLowerCase(); }
                
                if (va < vb) return order === 'asc' ? -1 : 1;
                if (va > vb) return order === 'asc' ? 1 : -1;
                return 0;
            });
            renderTable();
        }

        // Ch·∫°y ngay khi m·ªü trang
        getAll();
    </script>
</body>
</html>